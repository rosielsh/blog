---
title: "Chromatic + GitHub Actions로 스토리북 자동 배포 구축하기"
date: 2025-10-03
desc: PR 리뷰 과정에서 느낀 불편함을 해결하기 위해 스토리북 자동 배포 시스템을 구축한 과정을 담았습니다.
thumbnail: /posts/커피빵/chromatic/0.png
---

# 들어가며

팀원들과 함께 컴포넌트를 개발하면서, `PR`을 올릴 때마다 "이 컴포넌트 개발 사항을 확인해줘"라는 요청을 받곤 했습니다.

그럴 때마다 저는 브랜치를 체크아웃하고, 의존성을 설치하고, 스토리북을 실행하는 과정을 반복해야 했습니다.

<br />

이 글에서는 이러한 불편함을 해결하기 위해 제가 스토리북을 `Chromatic`으로 배포하고, `GitHub Actions`로 자동화한 과정을 담았습니다.

수동 배포부터 시작해 점진적으로 최적화해 나간 과정을 공유합니다.

<br />

# 문제 상황

팀에서 컴포넌트를 개발할 때 **스토리북**은 필수적인 도구입니다.

하지만 저희 커피빵 팀은 스토리북을 로컬 환경에서만 사용하고 배포하지 않았습니다. 그러다 보니 아래와 같은 불편함이 생겼습니다.

<br />

팀원이 새로운 컴포넌트를 구현하고 PR을 올려도 실시간으로 확인할 방법이 없었습니다.

<br />

<img src="/posts/커피빵/chromatic/1.png" width="500px" />

<br />

`UI`를 확인하려면 매번 해당 브랜치로 직접 체크아웃한 뒤, `npm install`과 `npm run storybook`을 반복해야 했습니다.

<br />

이런 불편함은 저만 느끼는 것이 아니었습니다. 팀원 모두가 같은 문제를 겪고 있었고, 그 결과 코드 리뷰 과정에서 불필요한 지연이 발생했습니다.

이 문제를 해결하기 위해 스토리북 배포를 진행하기로 결정했습니다.

<br />

## Chromatic을 선택한 이유

스토리북 배포 방법을 찾아보던 중 `Chromatic`을 알게 되었습니다.

[`Chromatic`](https://www.chromatic.com/)은 스토리북 공식 팀에서 만든 **배포 및 시각적 테스트 플랫폼**입니다.

<br />

`Chromatic`의 주요 장점은 아래와 같습니다.

1\. 간단한 CLI 명령어로 배포 가능

2\. `GitHub`과의 원활한 연동

3\. 시각적 회귀 테스트 기능 제공

4\. 공유 가능한 고유 `URL` 자동 생성

5\. 무료 플랜으로도 충분한 사용 가능

<br />

저는 이 중에서 특히 **링크 하나로 팀원들이 실시간으로 컴포넌트를 확인**할 수 있다는 점이 매력적이었습니다.

<br />

# 스토리북 배포하기

그럼 이제 `Chromatic`으로 스토리북을 배포해보겠습니다.

<br />

### 1. Chromatic 프로젝트 설정

먼저 `Chromatic` 웹사이트에서 `GitHub` 계정을 연동하고 프로젝트를 생성합니다.

프로젝트를 생성하면 아래와 같은 화면이 뜨는걸 볼 수 있습니다.

<img src="/posts/커피빵/chromatic/2.png" width="600px" />

<br />

그리고 현재 진행중인 프로젝트로 돌아가, 아래 명령어를 터미널에 입력하여 `Chromatic`을 설치합니다.

```tsx
npm install --save-dev chromatic
```

<br />

### 2. 배포하기

`Chromatic`에서 본 명령어를 그대로 터미널에 입력해줍니다.

`your-project-token`에는 현재 본인의 프로젝트 토큰이 들어가있을 것입니다.

```tsx
npx chromatic --project-token=<your-project-token>
```

<br />

이렇게 하면 배포는 끝이 났습니다!

아래 프로그레스바가 보이고, 배포가 진행됩니다.

<img src="/posts/커피빵/chromatic/3.png" width="600px" />

<br />

이 명령어가 실행되면 아래의 순서로 공유가 가능한 `URL`이 생성됩니다.

1\. 스토리북 빌드

2\. 빌드된 파일을 Chromatic 서버에 업로드

3\. 공유 가능한 `URL` 생성

<br />

이렇게 `View your Storybook~` 뒤에 있는 링크에 들어가면 배포가 된 화면을 볼 수 있는데요.

<img src="/posts/커피빵/chromatic/4.png" width="600px" />

<br />

드디어 스토리북을 팀원들과 공유할 수 있게 되었습니다~

<img src="/posts/커피빵/chromatic/5.png" width="600px" />

<br />

하지만 매번 배포할 때마다 위와 같은 과정을 거쳐야 할까요? 개발자로서 반복작업은 용납할 수 없었습니다.

<br />

# GitHub Actions로 자동화 해보자

### 자동화가 필요한 이유

위에서 진행했던 **수동 배포의 문제점**은 2가지 정도가 있다고 생각했습니다.

<br />

1\. 배포를 깜빡하면 팀원들이 최신 버전을 볼 수 없음

2\. 개발자가 매번 새로운 스토리 파일이 추가될 때 마다 배포 명령어를 실행해야 함

<br />

**이를 해결하기 위해 GitHub Actions와 연동하여 PR이 생성되거나 업데이트될 때마다 자동으로 배포하도록 설정해야겠다는 필요성을 느꼈습니다.**

<br />

### Github Actions가 뭔가요?

`github action`이란 `github`에서 공식적으로 제공하는 `CI/CD` 툴, 다시 말해 **개발의 `workflow`를 자동화할 수 있게 도와주는 툴**입니다.

<br />

그럼 이제 자동화 과정을 시작해보겠습니다!

### 1. GitHub Secrets 설정

먼저 `Chromatic` 프로젝트 토큰을 `GitHub Secrets`에 등록합니다.

이는 일반적으로 개발을 할 때 쓰는 환경변수라고 보면 되는데요. 보안을 위해 토큰을 코드에 직접 노출하지 않기 위해서 설정해줍니다.

<br />

**Project에 들어간 후 Settings → Secrets and variables → Actions → New repository secret을 순차적으로 눌러 줍니다.**

그리고 아래 값을 입력해줍니다.

- `Name`: `CHROMATIC_PROJECT_TOKEN`
- `Value`: `Chromatic`에서 발급받은 토큰

<br />

<img src="/posts/커피빵/chromatic/6.png" width="600px" />

<br />

`Repository secrets` 목록에 잘 떴다면, 추가가 완료된 것입니다.

<br />

### 2. 워크플로우 파일 작성

`github actions`에서 자동화 작업을 작성해주기 위해서는 `yml` 파일을 필수적으로 작성해주어야 하는데요.

이를 위해 `.github/workflows` 경로에 `chromatic.yml` 파일을 생성하고 아래와 같이 작성했습니다.

```tsx
  chromatic-deploy:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install dependencies
        run: npm install

      - name: Publish to Chromatic
        uses: chromaui/action@latest
        with:
          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
          workingDir: frontend
          branchName: preview
          exitZeroOnChanges: true
          onlyChanged: true
```

<br />

### **각 단계별 상세 설명**

워크 플로우의 각 단계가 왜 필요한지에 대해 설명하겠습니다.

<br />

**1) Checkout repository - 코드 가져오기**

`GitHub Actions`의 가상 머신은 **빈 상태로 시작**합니다. 따라서 가장 먼저 해야 할 일은 우리의 코드를 가져오는 것입니다. 따라서 아래 작업을 제일 먼저 진행해줍니다.

```tsx
- name: Checkout repository
  uses: actions/checkout@v4
  with:
    fetch-depth: 0
```

<br />

`fetch-depth: 0`을 설정한 이유는 `Chromatic`이 이전 빌드와 비교하여 변경사항을 감지하려면 전체 `Git` 히스토리가 필요하기 때문입니다. 기본값인 1은 최근 커밋만 가져옵니다.

<br />

**2) Install dependencies - 의존성 설치**

스토리북을 실행하려면 `node_modules` 폴더가 필요합니다. `node_modules` 내부에 스토리북 의존성이 설치되어 있기 때문이죠!

현재 가상 머신에는 아무것도 설치되어 있지 않으므로 의존성을 설치해야 합니다.

```tsx
- name: Install dependencies
  run: npm install
```

<br />

**3) Publish to Chromatic - 스토리북 배포**

마지막으로 배포를 진행할 환경이 세팅되어 있으니, 실제 배포 스크립트를 입력하여 배포를 진행해줍니다.

```tsx
- name: Publish to Chromatic
  run: npx chromatic --project-token=${{ secrets.CHROMATIC_PROJECT_TOKEN }}
```

<br />

따라서 해당 명령어의 순서는 아래와 같이 진행됩니다.

```tsx
빈 가상 머신 시작
    ↓
코드 다운로드 (checkout) ← 스토리북 파일들 필요
    ↓
npm install ← Chromatic CLI 및 의존성 설치 필요
    ↓
chromatic 실행 ← 스토리북 빌드 & 배포
    ↓
완료!
```

<br />

실행 로그를 확인하고 싶다면 `Actions`로 들어가 최근 실행된 자동화 내용을 선택해주면 됩니다.

<br />

<img src="/posts/커피빵/chromatic/7.png" width="700px" />

<br />

그러면 아래 로그를 통해서 접근 가능한 `URL` 링크를 볼 수 있습니다.

<br />

<img src="/posts/커피빵/chromatic/8.png" width="700px" />

<br />

# 배포 시 변경되는 URL을 고정할 수는 없을까?

### URL이 매번 변경되는 문제

자동화는 성공했지만 새로운 고민이 생겼습니다.

위에서 만들어진 링크는 매 배포마다 새로운 링크가 생성되기 때문에, 항상 다른 링크가 생성되게 되는데요.

만약 PR이 생성될 때마다 새로운 추가 커밋이 있을 때마다 자동화된 배포가 실행될 텐데,

이때 접근 가능한 URL이 달라지면 매 번 확인해야 하는 불편함이 있을 뿐더러 팀원들이 혼란스러울 것 같았습니다.

<br />

### 해결 방안

이를 해결하기 위해 `URL`을 고정해놓고 하나의 `URL`을 사용할 수는 없을지에 대해서 고민해보았고, 2가지의 방식이 있다는 것을 알게 되었습니다.

<br />

1\. **단일 URL 방식**

```tsx
main/develop 브랜치만 배포
→ https://main--projectid.chromatic.com
```

이 방식의 장점은 **어떤 브랜치에서든 동일한 링크를 공유**하기 때문에 심플하고 관리하기 쉬우며, 하나의 URL만 기억하면 되기 때문에 리뷰 과정에서 불필요하게 링크를 찾을 필요가 없다는 것입니다.

<br />

2\. **PR별 배포 방식**

```tsx
각 PR마다 별도 URL 생성
→ PR #123: https://pr-123--projectid.chromatic.com
→ PR #124: https://pr-124--projectid.chromatic.com
```

이 방식은 PR마다, 즉 다른 브랜치마다 별도의 URL을 생성하는 방식으로 **여러 PR의 UI 변경사항을 동시에 확인 가능**하고, 브랜치끼리 서로 변경 사항이 겹치지 않는다는 장점이 있었습니다.

<br />

### 결론 → 단일 URL 방식

저는 고민 끝에 단일 URL 방식을 선택했는데요. 이유는 아래와 같습니다.

1\. 우리 팀은 주로 서로 다른 컴포넌트를 작업함

2\. 같은 컴포넌트를 동시에 수정하는 경우가 거의 없음

3\. 고정된 하나의 URL이 팀원들에게 더 편리함

<br />

### 그럼 어떻게 고정 URL을 설정했나?

이에 대해서 이해하기 전에, 우선 `Chromatic`에서 `URL`을 생성하는 규칙에 대해서 이해할 필요가 있습니다.

`Chromatic`에서는 `URL`을 다음과 같은 규칙으로 생성할 수 있는데요. 이건 `Chromatic`에서 제공해주는 옵션 같습니다.

<br />

<aside>

https://`[브랜치명]`--`[프로젝트ID]`.chromatic.com

</aside>

<br />

`Chromatic` 프로젝트에 들어가면 `Manage → Collaborate` 탭에서 현재 고유 링크의 형식을 확인할 수 있는데요.

<br />

<img src="/posts/커피빵/chromatic/9.png" width="700px" />

<br />

여기 있는 링크로 들어가면 현재 **브랜치 이름을 기준으로 생성된 고유 링크에 접근 가능하다**는 의미 같습니다.

<br />

<img src="/posts/커피빵/chromatic/10.png" width="600px" />

<br />

여기서 달라지는 브랜치 명을 고정해주기 위해

`branchName: preview` 옵션을 추가하여 항상 동일한 브랜치명으로 배포되도록 설정했습니다.

```tsx
 - name: Publish to Chromatic
        uses: chromaui/action@latest
        with:
          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
          workingDir: frontend
          **branchName: preview**
          exitZeroOnChanges: true
          onlyChanged: true
```

이렇게 하면 `https://preview--[projectid].chromatic.com` 형태의 고정된 URL이 생성되고, 가장 최근에 푸시된 내용이 자동으로 반영됩니다.

<br />

**참고:** Chromatic은 자체적으로 브랜치 히스토리를 관리합니다. 따라서 Git 저장소에 `preview` 브랜치가 실제로 없어도 괜찮습니다. Chromatic의 데이터베이스에 `preview`라는 이름으로 빌드 기록이 저장됩니다.

<br />

# 배포 과정을 최적화해보자

### 쓸데 없이 오래 걸리는 시간

이렇게 빌드 해서 `push`를 하고, 자동 배포가 진행되는 것을 보니 대략 2분 남짓하는 시간이 걸리는 것을 볼 수 있었습니다.

<img src="/posts/커피빵/chromatic/11.png" width="600px" />

<br />

따라서 현재 진행중인 과정에서 불필요한 부분은 제거하자고 생각했고, 아래의 최적화 과정들을 진행해 주었습니다.

<br />

### 1. 변경된 파일만 감지해서 배포하기

모든 PR에서 스토리북을 배포하는 것은 비효율적일 수 있습니다.

만약 백엔드 코드만 수정한 PR에서도 스토리북이 배포된다면 리소스 낭비가 되겠죠.

<br />

**해결**: 스토리북 관련 파일이 변경되었을 때만 워크플로우 실행

```tsx
on: pull_request: branches: -fe / dev;
types: [opened, synchronize];
paths: -"frontend/**/*.stories.*" - "frontend/.storybook/**";
```

이제 `.stories` 파일, `.storybook` 설정 파일이 변경되었을 때만 배포가 진행됩니다.

<br />

### **2. npm 캐싱으로 빌드 시간 단축하기**

매번 `npm install`을 실행하면 모든 패키지를 다시 다운로드해야 합니다. 이는 시간이 오래 걸리고 비효율적입니다.

```tsx
- name: Setup Node.js
  uses: actions/setup-node@v4
  with:
    node-version: '20'
    cache: 'npm'
    cache-dependency-path: frontend/package-lock.json

- name: Install dependencies
  run: npm ci
```

`package-lock.json` 파일이 변경되지 않는 한 캐시를 재사용하므로 빌드 시간이 단축되었습니다.

<br />

### 3. 변경된 스토리만 스냅샷 테스트

매 번 **모든 스토리북에 있는 테스트 케이스들에 대해서 테스트**를 진행한다면, 아주 오랜 시간이 걸릴 것입니다.

예를 들어 지금은 기존에 `Chromatic`에서 관리하는 `preview`라는 브랜치가 없기 때문에, 프로젝트 전체에 작성해 준 137개의 테스트가 전체적으로 돌아가고 있는데요.

이 과정에서 **약 30초 가량의 시간**이 들고 있네요.

<br />

<img src="/posts/커피빵/chromatic/12.png" width="300px" />

<br />

하지만 **현재 PR에서만 변경된 파일들에 대해서 테스트를 진행**한다면 이보다 시간이 훨씬 단축될 것입니다.

<br />

기본적으로 `Chromatic`은 **모든 스토리**를 다시 렌더링하고 스냅샷을 찍는다고 합니다. 하지만 `onlyChange`라는 속성을 통해 이를 제어할 수 있는데요.

따라서 `onlyChanged: true`라는 속성을 추가하여 변경된 스토리만 스냅샷 테스트를 진행해 주었습니다.

<br />

- **전체 테스트**: 137개 스토리 전부 캡처
- **변경분만 테스트**: 예를 들어 Button만 수정했다면 Button 관련 5개 스토리만 캡처

<br />

---

## 자동화 후 달라진 점

스토리북 배포 자동화를 도입한 후 팀의 개발 경험이 개선되었습니다.

<br />

### 개발 프로세스의 변화

자동화 이전

```tsx
1. 팀원이 PR 생성
2. "스토리북 확인해 주세요" 요청
3. 리뷰어가 브랜치 체크아웃
4. npm install 실행 (매번 2~3분 소요)
5. npm run storybook 실행
6. 로컬에서 확인
7. 추가 커밋 시 1~6 과정 반복
```

자동화 이후

```tsx
1. 팀원이 PR 생성
2. "스토리북 확인해 주세요" 요청
3. 리뷰어가 브랜치 체크아웃
4. npm install 실행 (매번 2~3분 소요)
5. npm run storybook 실행
6. 로컬에서 확인
7. 추가 커밋 시 1~6 과정 반복
```

**그 외**

- PR 생성 시 자동으로 스토리북이 배포됨
- 고정된 URL로 언제나 최신 버전 확인 가능
- 코드 리뷰 시간 단축
- 개발자의 수동 배포 작업 제거

<br />

## 최종 워크플로우

```tsx
name: "Deploy Storybook to Chromatic"

on:
  pull_request:
    branches:
      - fe/dev
    types: [opened, synchronize]
    paths:
      - "frontend/**/*.stories.*"
      - "frontend/.storybook/**"

jobs:
  chromatic-deploy:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"
          cache-dependency-path: frontend/package-lock.json

      - name: Install dependencies
        run: npm ci

      - name: Publish to Chromatic
        uses: chromaui/action@latest
        with:
          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
          workingDir: frontend
          branchName: preview
          exitZeroOnChanges: true
          onlyChanged: true

      - name: Comment PR with Storybook URL
        uses: actions/github-script@v7
        if: github.event.action == 'opened'
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## 📚 Storybook Preview\n\n🔗 **고정 URL**: https://preview--68db92900b71dbe8fcff669b.chromatic.com\n\n최신 스토리북이 배포되었습니다!`
            })
```

<br />

# 마치며

스토리북 배포의 필요성을 느끼고 수동 배포로 시작해서 자동화에 이르기까지, 각 단계마다 "왜 이게 필요한가?"를 고민하며 개선했습니다.

처음에는 큰 불편함이 아니였기에 넘기려고 했지만, 이렇게 작은 불편함이라도 방치하지 않고 개선하려는 시도가 결국 팀 전체의 생산성을 높이고 협업 경험을 개선한다는 것을 알 수 있었습니다.

<br />

여러분의 팀에도 이런 작은 불편함이 있다면, 주저하지 말고 자동화를 시도해 보는 것을 권장합니다.

이 글이 같은 고민을 하고 있는 분들께 실질적으로 도움이 되었으면 좋겠습니다.

<br />

커피빵에 적용한 PR은 아래 링크에서 볼 수 있습니다!

[**PR 보러가기**](https://github.com/woowacourse-teams/2025-coffee-shout/pull/822)

감사합니다.
